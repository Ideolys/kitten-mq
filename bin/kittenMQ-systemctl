#!/bin/bash

script_location="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
fileConfigLocation="$script_location/kittenMQ.service"

sudo cp $fileConfigLocation /etc/systemd/system/kitten-mq.service
exec_kitten_mq=$(which kitten-mq)
escaped="${exec_kitten_mq//\//\\/}"
sudo sed -i -e "s/@exec/${escaped}/g" /etc/systemd/system/kitten-mq.service

sudo adduser kitten-mq --no-create-home --disabled-password --system
mkdir /var/www/kitten-mq
sudo cp "$script_location/config.json" /var/www/kitten-mq/kitten-mq.config.json
sudo chown -R kitten-mq /var/www/kitten-mq

sudo systemctl daemon-reload
sudo systemctl enable kitten-mq
sudo systemctl start kitten-mq
